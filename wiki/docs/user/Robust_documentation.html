<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title>General Ledger Viewer documentation</title>
	<meta name="generator" content="LibreOffice 6.0.7.3 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changed" content="2021-05-05T14:22:32.221414132"/>
	<meta name="" content=""/>
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<style type="text/css">
		h1 { text-align: center }
		h1.western { font-family: "Liberation Sans", sans-serif; font-size: 28pt; font-weight: normal }
		h2.cjk { font-family: "Noto Sans CJK SC" }
		h2.ctl { font-family: "Lohit Devanagari" }
		h4.cjk { font-family: "Noto Sans CJK SC" }
		h4.ctl { font-family: "Lohit Devanagari" }
		pre.cjk { font-family: "DejaVu Sans Mono", monospace }
		h3.cjk { font-family: "Noto Sans CJK SC" }
		h3.ctl { font-family: "Lohit Devanagari" }
	</style>
</head>
<body lang="en-US" dir="ltr">
<h1 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in; font-weight: normal">
<font face="Lato Semibold"><font size="7" style="font-size: 36pt">Robust</font></font></h1>
<h1 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
Investment calculator</h1>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
things to keep in mind</h2>
<h3 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
general</h3>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Account
	names, unit names, member names, etc, must be specified exactly. “x
	123 456” is not the same as “x-123-456”.</p>
</ul>
<h3 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
bank accounts</h3>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Sheet
	name has to start with “bankstatement “</p>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Account_Number
	is ignored, only Account_Name matters</p>
	<li/>
<p>opening balance can only be correctly processed for bank
	accounts in the same currency as report currency.</p>
</ul>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
open issues</h2>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Items in
	balance sheet and other reports get randomly reordered. (a general
	robust bug)</p>
</ul>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
accounts</h2>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Robust needs to
know what <a href="http://dbpedia.org/page/General_ledger">General_ledger</a>
(GL) accounts there are. For each account, it needs to know: 
</p>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">name - an
	arbitrary string, ideally unique</p>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">parent-child
	relationships with other GL accounts</p>
</ul>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">The initial set
of accounts is specified in the field “account taxonomies”. You
can select one or more prepared sets, or enter your own URL with a
XML description of account hierarchy.</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><img src="Robust_documentation_html_3f1b662c3de2beb4.gif" name="Image3" align="left" width="857" height="386">
  <br clear="left"/>
</img>
<br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Robust also
generates some accounts automatically, to subcategorize some accounts
by bank name, by investment, by livestock name, etc.</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Users can
address accounts by names, or by roles:</p>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
<br/>
<br/>

</h2>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
<br/>
<br/>

</h2>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
Roles</h2>
<h3 class="western">Purpose</h3>
<p style="margin-bottom: 0in"><br/>

</p>
<p style="margin-bottom: 0in">If a trading account
Financial_Investments already contains</p>
<p style="margin-bottom: 0in">an account with id
Financial_Investments_realized, either it has to have a role
Financial_Investments/realized,</p>
<p style="margin-bottom: 0in">or is not recognized as such, and a new
one with proper role is proposed. This allows us to abstract away
from ids,</p>
<p style="margin-bottom: 0in">because Financial_Investments_realized
might already be an id of another user account, intended for a
different purpose.</p>
<p style="margin-bottom: 0in">Or:</p>
<p style="margin-bottom: 0in">mixing and matching roles: consider a
case where we have multiple bank accounts, each needs a corresponding
CurrencyMovement sub-account, but we want a part of the bank accounts
to use one CurrencyMovement account and a part to use another:</p>
<p style="margin-bottom: 0in">&lt;ComprehensiveIncome&gt;</p>
<p style="margin-bottom: 0in">&lt;VolatileCurrencyMovement&gt;</p>
<p style="margin-bottom: 0in">&lt;BitcoinCurrencyMovement&gt;</p>
<p style="margin-bottom: 0in">&lt;/VolatileCurrencyMovement&gt;</p>
<p style="margin-bottom: 0in">&lt;NormalCurrencyMovement&gt;</p>
<p style="margin-bottom: 0in">&lt;Bank1CurrencyMovement&gt;</p>
<p style="margin-bottom: 0in">&lt;/NormalCurrencyMovement&gt;</p>
<p style="margin-bottom: 0in">&lt;/ComprehensiveIncome&gt;</p>
<p style="margin-bottom: 0in">Thus, we have to specify these accounts
manually (in a xml file). And we have to assign the right roles to
them, so the system can recognize them.</p>
<p style="margin-bottom: 0in"><br/>

</p>
<h3 class="western">Syntax</h3>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">A role is a
path, much like a file path in a computer:</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><img src="Robust_documentation_html_220dae5d44ef6a0e.gif" name="Image4" align="left" width="513" height="32">
  <br clear="left"/>
</img>
<br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">The exclamation
marks (<i>!</i>) are path separators, like “/” in a file path.
There isn’t a good way to manage these roles yet, but we need to
understand the “<i>&lt;Member&gt;</i>” part above. The angle
brackets (<i>&lt;&gt;</i>) enclose a “slot”, that is, a variable,
in other words, an empty place, where something else will be put.
That something is taken from the “<i>param</i>” columns:</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><img src="Robust_documentation_html_25d2279a69dc400e.gif" name="Image5" align="left" width="288" height="65">
  <br clear="left"/>
</img>
<br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">In effect, the
role path becomes: “<i>!Share_of_Profit/(Loss) –
Preserved/Taxable!John Smith!”.</i> Each angle-bracketed slot has
to match up with one nonempty “param” column.</p>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
<br/>
<br/>

</h2>
<h2 class="western">action verbs</h2>
<pre class="western" style="background: #ffffff"><font color="#3c3b31"><font face="Fira Code Medium, monospace"><font size="2" style="font-size: 10pt">action verbs in general:</font></font></font>
<font color="#3c3b31">   <font face="Fira Code Medium, monospace"><font size="2" style="font-size: 10pt">Invest_In</font></font></font>
<font color="#3c3b31">   <font face="Fira Code Medium, monospace"><font size="2" style="font-size: 10pt">Dispose_Off</font></font></font>
<font color="#3c3b31">      <font face="Fira Code Medium, monospace"><font size="2" style="font-size: 10pt">magic: affect counteraccount's Unit subaccount</font></font></font>
<font color="#3c3b31"><font face="Fira Code Medium, monospace"><font size="2" style="font-size: 10pt">&quot;trading account&quot; parameter of action verb:</font></font></font>
<font color="#3c3b31">   <font face="Fira Code Medium, monospace"><font size="2" style="font-size: 10pt">magic: affect &quot;trading account&quot;'s Unit subaccount</font></font></font></pre><h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
Opening balances</h2>
<h3 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
general ledger method</h3>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">implemented:
		</p>
</ul>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><img src="files/2020-03-02.png" name="Image2" align="left" width="823" height="463">
  <br clear="left"/>
</img>
<br/>
<br/>

</p>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">not
	implemented:</p>
</ul>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><img src="files/picturemessage_pa5mqqi0.pwd.png" name="Image1" align="left" width="750" height="257">
  <br clear="left"/>
</img>
<br/>
<br/>

</p>
<h3 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
higher level methods</h3>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">bank
	opening balance row in excel</p>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">translation
	to GL can be in one of two ways:</p>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">posted
	into Historical_Earnings account at opening date</p>
	<ul>
		<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">creates
		correct balance sheet, but creates inconsistency when analyzing
		individual bank accounts (cashflow), because bank account is
		debited at opening date</p>
	</ul>
	<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">currently
	implemented by 'Historical_Earnings_Lump' action verb</p>
	<ul>
		<li/>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">posted
		into Current_Earnings account before opening date</p>
	</ul>
</ul>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
<br/>
<br/>

</h2>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
<br/>
<br/>

</h2>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
Currency movement transactions</h2>
<h4 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
introduction</h4>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">By default,
currency movement is accounted for in a declarative way. This is in
contrast to the use of adjustment transactions. Our GL balances at
any point in time. In-depth explanation of the principle is in
<a href="https://www.mathstat.dal.ca/~selinger/accounting/tutorial.html#4">Tutorial
on multiple currency accounting</a>. 
</p>
<h4 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
principle</h4>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">In short: bank
account is in some currency, for example USD. Report currency is for
example AUD. If bank account is debited 100 USD on &quot;date(2019,9,9)&quot;,
a corresponding equity/p&amp;l account is credited, for example, 120
AUD, according to the conversion rate valid at the transaction date.
The GL always balances because the drift in USD/AUD rate is accounted
for on the Currency_Movement account, for example
CurrencyMovementHelvetische_BankUSD. The entry created on this
account would be literally CR 120 USD, DR 100 AUD, but things are a
little more complicated, and the actual entry looks like this: 
</p>
<pre class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">CR 100 USD, DR 100 without_currency_movement_against_since('USD','USD',['AUD'],date(2019,9,9))</pre><p style="margin-top: 0.02in; margin-bottom: 0.02in">
. This whole 
</p>
<pre class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">without_currency_movement_against_since('USD','USD',['AUD'],date(2019,9,9))</pre><p style="margin-top: 0.02in; margin-bottom: 0.02in">
is understood as &quot;USD, disregarding movement of USD against AUD
since date(2019,9,9)&quot;. The program does the appropriate
conversion to AUD when generating reports. 
</p>
<pre class="western" style="margin-top: 0.02in; margin-bottom: 0.02in"><font color="#000000">Another declarative unit is “without_movement_after(Unit, Date)”. </font></pre><p style="margin-top: 0.02in; margin-bottom: 0.02in">
Todo: the semantics are similar, review if we need both. review if
the use of this abstract unit is necessary here, i think we can
simplify. 
</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">todo: explain
split into historical and current entry, for historical transactions.
</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<h2 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
Error recovery</h2>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">S_Transaction
processing error recovery:</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">It's not
possible to determine order of transactions that transpired on one
day, so to avoid confusion, when we fail to process a transaction, we
go back all the way to the end of the previous day, and try to run
the reports again, excluding all the transactions of the erroring day
and after.</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">We originally
tried generating all reports for the &quot;last good&quot; day, but
that had issues, at least with investment report failing because of
missing exchange rates. So, rather, we run the reports for the
request end date.</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<h1 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
<meta name="created" content="00:00:00"><meta name="created" content="00:00:00"><meta name="created" content="00:00:00">Architecture</h1>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">Robust is
currently a single-pass architecture. Processing is triggered by
submitting a request file in RDF format (+ currently also a legacy
XML file), that should be processed, to the web API. This file is
generated by the excel plugin, contains data extracted from multiple
worksheets, and can reference additional files to be processed (XBRL
taxonomy, bank statements in CSV format..). Robust tries to fit the
information in those files into a single model, fill in missing
information, and, if successful, it produces multiple output files
(“reports”).</p>
<h1 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
Formulas</h1>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">In comparison to
full XBRL support, we do not enable computing of arbitrary facts by
arbitrary formulas, and we have a hard-coded set of reports that
display a hard-coded set of facts. 
</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in">(wip, <a href="https://github.com/LodgeiT/labs-accounts-assessor/issues/174">#174</a>),
</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<h1 class="western" style="margin-top: 0.02in; margin-bottom: 0.02in">
exchange dates</h1>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p style="margin-top: 0.02in; margin-bottom: 0.02in"><br/>
<br/>

</p>
<p><b>Let's ignore how openexchangerates actually calculates their
values.</b> In particular, we ignore the possibility that what the
service (or another) provides as a date's value is actually the
previous day's average value, and we will not try to compensate, for
such hypothetical issues, in ledger's core logic.</p>
<p><b>We assume a simplified theory:</b> 
</p>
<ul>
	<li/>
<p>an exchange rate for a particular date is the rate at which
	a unit is/was traded at that day.</p>
	<li/>
<p>A day is an atomic unit (for purposes of exchange dates
	discussion).</p>
	<li/>
<p>Every transaction belongs to a date.</p>
	<li/>
<p>Using days as a time unit is arbitrary, the core logic
	would support, for example, hours, just as well. What really matters
	is that (report) time is subdivided divided into discrete units.</p>
	<li/>
<p></p>
</ul>
<p><br/>
<br/>

</p>
<p><br/>
<br/>

</p>
<p> 
</p>
</body>
</html>